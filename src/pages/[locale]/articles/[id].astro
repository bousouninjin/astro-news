---
import { render } from "astro:content";
import BaseLayout from "@/layouts/base.astro";
import ContentLayout from "@/layouts/content.astro";
import ArticleHeader from "@/pages/articles/_components/article-header.astro";
import { articlesHandler } from "@/lib/handlers/articles";
import { DEFAULT_LOCALE, LOCALES } from "@/i18n/config";
import { getEntrySlug } from "@/i18n/content";

export const getStaticPaths = async () => {
  const locales = LOCALES.filter((entry) => entry !== DEFAULT_LOCALE);
  const paths = [];
  for (const locale of locales) {
    const articles = await articlesHandler.allArticles(locale);
    paths.push(
      ...articles.map((article) => ({
        params: { locale, id: getEntrySlug(article) },
        props: { article },
      }))
    );
  }
  return paths;
};

const { article } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(article);
---

<BaseLayout entry={article}>
  <ArticleHeader
    article={article}
    readingTime={remarkPluginFrontmatter.minutesRead}
  />
  <ContentLayout>
    <Content />
  </ContentLayout>
</BaseLayout>
