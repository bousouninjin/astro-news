---
import Menu from "@/assets/svgs/menu.astro";
import { OTHER_LINKS } from "@/lib/config";
import { categoriesHandler } from "@/lib/handlers/categories";
import { localizePath } from "@/i18n/paths";
import { t } from "@/i18n/config";

const locale = Astro.currentLocale;
const categories = await categoriesHandler.allCategories(locale);
const homeUrl = localizePath(locale, "/");
const articlesUrl = localizePath(locale, "/articles");

const resolveLink = (href: string) =>
  href.startsWith("http") ? href : localizePath(locale, href);

const getLabel = (labelKey?: string, fallback?: string) =>
  labelKey ? t(locale, labelKey as never) : fallback ?? "";
---

<div class="dropdown">
  <button
    tabindex="0"
    role="button"
    class="btn btn-ghost btn-circle"
    aria-label={t(locale, "nav.menu")}
  >
    <Menu />
  </button>

  <ul
    tabindex="0"
    class="menu dropdown-content z-50 bg-base-100 rounded-box w-56 shadow"
  >
    <li>
      <a href={homeUrl} aria-label={t(locale, "nav.home")}>
        {t(locale, "nav.home")}
      </a>
    </li>
    <li>
      <a href={articlesUrl} aria-label={t(locale, "nav.articles")}>
        {t(locale, "nav.articles")}
      </a>
    </li>

    <li>
      <details>
        <summary>{t(locale, "nav.categories")}</summary>
        <ul>
          {
            categories.map((category) => (
              <li>
                <a
                  href={`${localizePath(locale, `/categories/${category.data.path}`)}/1`}
                  aria-label={category.data.title}
                >
                  {category.data.title}
                </a>
              </li>
            ))
          }
        </ul>
      </details>
    </li>

    <li>
      <details>
        <summary>{t(locale, "nav.otherPages")}</summary>
        <ul>
          {
            OTHER_LINKS.map(({ href, text, labelKey, target }) => (
              <li>
                <a
                  href={resolveLink(href)}
                  target={target ?? "_self"}
                  aria-label={getLabel(labelKey, text)}
                >
                  {getLabel(labelKey, text)}
                </a>
              </li>
            ))
          }
        </ul>
      </details>
    </li>
  </ul>
</div>
